<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ìì¬ ì´ë ¥ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; line-height: 1.6; }
        .search-box { margin-bottom: 20px; padding: 15px; background: #f4f4f4; border-radius: 8px; }
        input { padding: 8px; width: 200px; }
        button { padding: 8px 15px; cursor: pointer; background: #33b5e5; border: none; color: white; border-radius: 4px; }
        .log-item { border-bottom: 1px solid #ddd; padding: 10px 0; list-style: none; }
        .status-tag { font-weight: bold; color: #2c3e50; }
    </style>
</head>
<body>

    <h2>ğŸ“¦ ìì¬ ì´ë ¥ ì¡°íšŒ ì‹œìŠ¤í…œ</h2>

    <div class="search-box">
        <input type="text" id="itemCodeInput" placeholder="ë¬¼í’ˆ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ITEM001)">
        <button onclick="getHistory()">ì¡°íšŒí•˜ê¸°</button>
    </div>

    <div id="result-area" style="display:none;">
        <h3>ë¬¼í’ˆ ì •ë³´: <span id="itemName"></span></h3>
        <ul id="logList" style="padding: 0;"></ul>
    </div>

    <script>
        // Supabase ì„¤ì • (ë³¸ì¸ì˜ ì •ë³´ë¡œ ê¼­ ë³€ê²½í•˜ì„¸ìš”!)
        const SUPABASE_URL = 'https://your-project-url.supabase.co';
        const SUPABASE_KEY = 'your-anon-key';
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        async function getHistory() {
            const code = document.getElementById('itemCodeInput').value.trim();
            const logList = document.getElementById('logList');
            const resultArea = document.getElementById('result-area');
            const itemNameSpan = document.getElementById('itemName');

            if (!code) {
                alert("ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return;
            }

            // A. items í…Œì´ë¸”ì—ì„œ í’ˆëª… ê°€ì ¸ì˜¤ê¸°
            const { data: item, error: itemErr } = await supabase
                .from('items')
                .select('name')
                .eq('code', code)
                .single();

            if (itemErr || !item) {
                alert("í•´ë‹¹ ì½”ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                resultArea.style.display = 'none';
                return;
            }

            // B. logs í…Œì´ë¸”ì—ì„œ í•´ë‹¹ ì½”ë“œì˜ ì´ë ¥ ê°€ì ¸ì˜¤ê¸°
            const { data: logs, error: logErr } = await supabase
                .from('logs')
                .select('*')
                .eq('item_code', code)
                .order('created_at', { ascending: false });

            if (logErr) {
                console.error(logErr);
                return;
            }

            // C. í™”ë©´ì— ë°ì´í„° ë¿Œë¦¬ê¸°
            itemNameSpan.innerText = item.name;
            logList.innerHTML = ''; // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™”
            resultArea.style.display = 'block';

            if (logs.length === 0) {
                logList.innerHTML = '<li>ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</li>';
            } else {
                logs.forEach(log => {
                    const li = document.createElement('li');
                    li.className = 'log-item';
                    li.innerHTML = `
                        <span class="status-tag">[${log.status}]</span> 
                        <span>${new Date(log.created_at).toLocaleString()}</span>
                        <p style="margin: 5px 0 0 0; font-size: 0.9em; color: #666;">ìƒì„¸ë‚´ìš©: ${log.note || 'ì—†ìŒ'}</p>
                    `;
                    logList.appendChild(li);
                });
            }
        }
    </script>
</body>
</html>
