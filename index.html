<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìì¬ê´€ë¦¬ ì§„ë‹¨ëª¨ë“œ</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f4f7f6; }
        .card { background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #ddd; }
        .error-box { background: #ffeded; color: #d32f2f; padding: 15px; border-radius: 8px; border: 1px solid #f44336; display: none; }
        .success-box { background: #e8f5e9; color: #2e7d32; padding: 10px; border-radius: 8px; margin-bottom: 10px; }
        .log-item { border-bottom: 1px solid #eee; padding: 10px 0; }
        button { width: 100%; padding: 12px; background: #2ecc71; color: white; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

    <div id="debug-info" class="success-box">ğŸš€ ì‹œìŠ¤í…œ ê°€ë™ ì¤‘...</div>
    <div id="error-display" class="error-box"></div>

    <div class="card">
        <h2 id="item_name">ë°ì´í„° í™•ì¸ ì¤‘...</h2>
        <p id="item_id_display"></p>
    </div>

    <div class="card">
        <h3>ğŸ“œ ì´ë ¥ ëª©ë¡</h3>
        <div id="log_list">ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
    </div>

    <script>
        // 1. ì„¤ì • í™•ì¸
        const SUPABASE_URL = "https://tpbqizzzcsfxjilkbfwc.supabase.co";
        const SUPABASE_KEY = "sb_publishable_ElqhAkEJ8st_UU73voffwQ_tFP8mO02"; // <-- ì—¬ê¸°ì— eyJ...ë¡œ ì‹œì‘í•˜ëŠ” ê¸´ í‚¤ë¥¼ ë„£ìœ¼ì…¨ë‚˜ìš”?

        const urlParams = new URLSearchParams(window.location.search);
        const itemId = urlParams.get('id');

        // ì—ëŸ¬ í‘œì‹œ í•¨ìˆ˜
        function showError(msg, detail) {
            const errDiv = document.getElementById('error-display');
            errDiv.style.display = 'block';
            errDiv.innerHTML = `<strong>âŒ ì—ëŸ¬ ë°œìƒ:</strong> ${msg}<br><small>${detail}</small>`;
            console.error(msg, detail);
        }

        async function loadData() {
            if (!itemId) {
                showError("URLì— idê°€ ì—†ìŠµë‹ˆë‹¤.", "ì£¼ì†Œ ëì— ?id=ë¬¼í’ˆë²ˆí˜¸ ë¥¼ ë¶™ì—¬ì£¼ì„¸ìš”.");
                return;
            }

            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/items?item_id=eq.${itemId}&select=*,item_logs(*)`, {
                    headers: { 
                        "apikey": SUPABASE_KEY, 
                        "Authorization": `Bearer ${SUPABASE_KEY}` 
                    }
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`Supabase ì‘ë‹µ ì‹¤íŒ¨ (${response.status}): ${errorData.message || 'ê¶Œí•œ(RLS) ë˜ëŠ” í‚¤ ë¬¸ì œ'}`);
                }

                const data = await response.json();
                
                if (data.length === 0) {
                    document.getElementById('item_name').innerText = "ë¬¼í’ˆ ì—†ìŒ";
                    document.getElementById('log_list').innerText = `'${itemId}'ì— í•´ë‹¹í•˜ëŠ” ë°ì´í„°ê°€ DBì— ì—†ìŠµë‹ˆë‹¤.`;
                } else {
                    const item = data[0];
                    document.getElementById('item_name').innerText = item.item_name;
                    document.getElementById('item_id_display').innerText = `ID: ${item.item_id}`;
                    
                    const logs = item.item_logs || [];
                    document.getElementById('log_list').innerHTML = logs.length > 0 
                        ? logs.map(l => `<div class="log-item"><strong>${l.author}</strong>: ${l.content}</div>`).join('')
                        : "ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.";
                }
            } catch (err) {
                showError("ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.", err.message);
            }
        }

        loadData();
    </script>
</body>
</html>
